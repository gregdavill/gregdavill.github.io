<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Boson Frame Grabber Part 6 | Greg Davill's Projects</title>
<meta name=keywords content="boson,boson-frame-grabber,thermal,DiVA"><meta name=description content="Still alive? ü™¶
Yes, it&rsquo;s true this project did get dropped for awhile, it&rsquo;s been about 3 years since the last blog post."><meta name=author content><link rel=canonical href=https://gregdavill.com/posts/boson-frame-grabber-pt6/><link crossorigin=anonymous href=/assets/css/stylesheet.04f923ef139fd26f3f610e33d5547e96e9376d76dd088ad535ded906e3591395.css integrity="sha256-BPkj7xOf0m8/YQ4z1VR+luk3bXbdCIrVNd7ZBuNZE5U=" rel="preload stylesheet" as=style><link rel=icon href=https://gregdavill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gregdavill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gregdavill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://gregdavill.com/apple-touch-icon.png><link rel=mask-icon href=https://gregdavill.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gregdavill.com/posts/boson-frame-grabber-pt6/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Boson Frame Grabber Part 6"><meta property="og:description" content="Still alive? ü™¶
Yes, it&rsquo;s true this project did get dropped for awhile, it&rsquo;s been about 3 years since the last blog post."><meta property="og:type" content="article"><meta property="og:url" content="https://gregdavill.com/posts/boson-frame-grabber-pt6/"><meta property="og:image" content="https://gregdavill.com/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-17T17:56:32+10:30"><meta property="article:modified_time" content="2021-11-17T17:56:32+10:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gregdavill.com/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6.jpeg"><meta name=twitter:title content="Boson Frame Grabber Part 6"><meta name=twitter:description content="Still alive? ü™¶
Yes, it&rsquo;s true this project did get dropped for awhile, it&rsquo;s been about 3 years since the last blog post."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gregdavill.com/posts/"},{"@type":"ListItem","position":2,"name":"Boson Frame Grabber Part 6","item":"https://gregdavill.com/posts/boson-frame-grabber-pt6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Boson Frame Grabber Part 6","name":"Boson Frame Grabber Part 6","description":"Still alive? ü™¶ Yes, it\u0026rsquo;s true this project did get dropped for awhile, it\u0026rsquo;s been about 3 years since the last blog post.\n","keywords":["boson","boson-frame-grabber","thermal","DiVA"],"articleBody":"Still alive? ü™¶ Yes, it‚Äôs true this project did get dropped for awhile, it‚Äôs been about 3 years since the last blog post.\nDigital video Adapter (DiVA) After implementing the SD controller I had kind of got to a limit of what I could get the hardware to do. Recall that this project was my first foray into FPGAs. However after seeing this project, GroupGets reached out interested in working on a digital video adapter PCB. The idea being a way to adapt the Boson to a digital video stream, like DVI or HDMI. FLIR already provide a ‚ÄúVPC‚Äù breakout, which stands for Video, Comms, and Power. However this cable provides composite video output, which isn‚Äôt great if you want to persevere the quality, or if you want to capture the full dynamic range.\nSo that‚Äôs one of the boards I designed. Here are some assembly photos from the initial prototype to show that it was possible.\nThe PCBs were put into a small panel to make them a bit more manageable to assemble. The panel has some non-plated through-holes around it‚Äôs frame that align with features I put onto the stencil. This enabled the use of some 1.6mm steel pins to perfectly align the stencil to the PCB.\nThis actually works really well, the main issue I‚Äôve seen is that you don‚Äôt want the pins to interfere with the squeegee action, here they are protruding a bit too high from the top of the stencil.\nSolderpaste went down well, I‚Äôm using Loctite GC-10 here. The T4 variant.\nYou can see in this image that I forgot that the HDMI connector has pins that protrude through the PCB. So if I had reflowed the connector I would not be able to sit a stencil flush with the second side of the PCB. Doh.\nThe fix was pretty simple, leave the connector off, reflow, then assemble the second side with an additional reflow cycle then hand solder on the HDMI connector.\nFor extra units I simply soldered the FPGA side up first.\nYou can see the device very much resembles the boson-frame-grabber design.\nYou do need to be careful with the 80-pin Hirose mezzanine connector. You really want to keep the two mated PCBs parallel when removing them. I unfortunately damaged a connector removing it.\nThe full sized HDMI connector is a bit ridiculous given the size of the camera. So altough I typically don‚Äôt like micro HDMI connectors, this was actually quite a nice fit for this camera\nThis prototype did work. However because I didn‚Äôt include any RAM, the FPGA is only able to output a similar resolution, 640x512. In this case 640x480, with top/bottom rows of pixel removed.\nThis restriction is because we are essentially capturing a stream of pixels, and have to also output a stream of pixels to the display. In order for us to not run-out of pixels to send to the display We need to run the output clock rate a something very similar to the input.\nEven with this hiccup, the prototype proved the design could work. So with the proof of concept done I started work on the design for a more production ready variant.\nInital production prototypes Here is the initial production version, which turned out to have some layout bugs and issues.\nYou can see I‚Äôve added the hyperRAM back to the board, and also added USB C for power/and comms. The USB passes through a mux so you can use the Boson UVC device or talk to the FPGA at USB FS speeds. The USB is used to implement a bootloader that lets you update the device firmware/gateware.\nHere is shot of the final production variant, that are available now on the group-gets store: https://store.groupgets.com/products/flir-boson-digital-video-adapter\nDiVA gateware The hardware for this camera is not open-source. But the gateware/firmware is! You can find that here: https://github.com/gregdavill/DiVA-firmware\nAs an example of what the device does here is a capture of it‚Äôs output, with on-screen menus.\nThe current stable gateware is based on LiteX and Serv, LiteX is a collection of CPUs and peripherals along with plumbing to connect them all up. It‚Äôs written on top of migen, a method to describe and generate verilog from python. Serv is a serial RISCV implementation. It‚Äôs interesting because it‚Äôs quite small, therefore can run a quite a high frequency. However that higher frequency does need to overcome the fact that all instructions take at least 32 times longer to execute, because it‚Äôs a serial CPU, it‚Äôs internal data-path is only 1 bit wide, so to operate as a RISCV-RV32 it needs lots of extra cycles.\nCompared to raw verilog, going around and finding cores, then connecting them together in a SoC design. I find using LiteX way more productive, but there is a bit of a learning curve.\nThe gateware that runs DiVA is essentially a SoC, HyperRAM controller, DMAs, and TMDS serializer. These components work together to capture a frame from the camera into memory, and then queue that frame for transmitting back out through the serializer.\nv1.2 of the gateware also introduced a video scaler, which does appear to work, but might be distorting colours a bit, since it‚Äôs just combining R,G,B values linearly with coefficients from the scaler. I‚Äôve been told that ‚Äúproper‚Äù upscaling likely requires converting to a different colour space, combining colours, then converting back to RGB.\nThe scaler is a simple design I came up with after watching some lectures on multi-tap ‚Äúpolyphase‚Äù filters. The scaler only performs the up-scale operation. A stream of pixels comes through 4 ‚Äútaps‚Äù. These taps cycle through coefficients that are loaded by the CPU. The coefficients have a flag to stall incoming pixels, but increment to the next step. This enables the upscaling operation. These coefficients are pre-calculated and match with a bilinear interpolation of the input to output ratio of scaling we want to achieve. I‚Äôll probably try to make a more detailed blog post about that at some point.\nThe scaler can perform various stretch operations, since different coefficients are used for X/Y.\nFill (crops top/bottom) Fit (borders on left/right) Center 1:1 Full Screen (Changes aspect ratio) There is also some buffering logic in there to enable coefficient banks to swap at the end of frame, to avoid graphical distortions while switching scaling options.\nUpdated DiVA gateware There are a few open issues with the existing DiVA gateware, notably that it currently only supports 800x600 output resolution. And many HDMI transmitters expect at least 1280x720.\nThe hardware should technically support this, but someone needs to sit down and write the gateware to do it. I have started, but it‚Äôs far from complete yet.\nI do also have plans to update the video pipeline to support more ‚Äúmodern‚Äù looking GUIs. But that work isn‚Äôt completed yet. For the time being, here is a demo image, showing various GUI elements ontop of a noise source. Also note that it‚Äôs output at 1280x720 resolution.\n","wordCount":"1161","inLanguage":"en","image":"https://gregdavill.com/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6.jpeg","datePublished":"2021-11-17T17:56:32+10:30","dateModified":"2021-11-17T17:56:32+10:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://gregdavill.com/posts/boson-frame-grabber-pt6/"},"publisher":{"@type":"Organization","name":"Greg Davill's Projects","logo":{"@type":"ImageObject","url":"https://gregdavill.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gregdavill.com/ accesskey=h title="Greg Davill's Projects (Alt + H)">Greg Davill's Projects</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gregdavill.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://gregdavill.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://gregdavill.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gregdavill.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gregdavill.com/>Home</a>&nbsp;¬ª&nbsp;<a href=https://gregdavill.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Boson Frame Grabber Part 6</h1><div class=post-meta><span title='2021-11-17 17:56:32 +1030 +1030'>November 17, 2021</span>&nbsp;¬∑&nbsp;6 min&nbsp;|&nbsp;<a href=https://github.com/gregdavill/gregdavill.github.io/blob/main/blog-src/content/posts/boson-frame-grabber-pt6/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=still-alive->Still alive? ü™¶<a hidden class=anchor aria-hidden=true href=#still-alive->#</a></h1><p>Yes, it&rsquo;s true this project did get dropped for awhile, it&rsquo;s been about 3 years since the last blog post.</p><h2 id=digital-video-adapter-diva>Digital video Adapter (DiVA)<a hidden class=anchor aria-hidden=true href=#digital-video-adapter-diva>#</a></h2><p>After implementing the SD controller I had kind of got to a limit of what I could get the hardware to do. Recall that this project was my first foray into FPGAs. However after seeing this project, GroupGets reached out interested in working on a digital video adapter PCB. The idea being a way to adapt the Boson to a digital video stream, like DVI or HDMI. FLIR already provide a &ldquo;VPC&rdquo; breakout, which stands for Video, Comms, and Power. However this cable provides composite video output, which isn&rsquo;t great if you want to persevere the quality, or if you want to capture the full dynamic range.</p><p>So that&rsquo;s one of the boards I designed. Here are some assembly photos from the initial prototype to show that it was possible.</p><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7YkVnHUwAAMue0_hu5976338228086708319.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7YkVnHUwAAMue0_hu2177130132809154666.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7YkVnHUwAAMue0_hu13477383308577777968.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7YkVnHUwAAMue0_hu2177130132809154666.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7YkVm8U0AA_q36_hu5337554421142191343.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7YkVm8U0AA_q36_hu12778833089810956030.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7YkVm8U0AA_q36_hu11436160775961407292.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7YkVm8U0AA_q36_hu12778833089810956030.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7YkLMfV4AAVLAc_hu12520776905514272284.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7YkLMfV4AAVLAc_hu5791371969758673076.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7YkLMfV4AAVLAc_hu1693015219794141770.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7YkLMfV4AAVLAc_hu5791371969758673076.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7kpCnMU8AEjd0c_hu18091157012630660856.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7kpCnMU8AEjd0c_hu7467335775495389426.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7kpCnMU8AEjd0c_hu7167536849165285001.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7kpCnMU8AEjd0c_hu7467335775495389426.jpeg alt></figure></p><p>The PCBs were put into a small panel to make them a bit more manageable to assemble. The panel has some non-plated through-holes around it&rsquo;s frame that align with features I put onto the stencil. This enabled the use of some 1.6mm steel pins to perfectly align the stencil to the PCB.</p><p>This actually works really well, the main issue I&rsquo;ve seen is that you don&rsquo;t want the pins to interfere with the squeegee action, here they are protruding a bit too high from the top of the stencil.</p><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7kwojcUYAAj0S7_hu5412280755852831532.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7kwojcUYAAj0S7_hu6445150174813198951.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7kwojcUYAAj0S7_hu4443508219815443481.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7kwojcUYAAj0S7_hu6445150174813198951.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7kpNaQUwAc9265_hu7262382462450379998.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7kpNaQUwAc9265_hu11697252819074236725.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7kpNaQUwAc9265_hu1709397075389318875.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7kpNaQUwAc9265_hu11697252819074236725.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7kwojjVUAA3YA0_hu3649396455262883297.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7kwojjVUAA3YA0_hu1270875721027376811.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7kwojjVUAA3YA0_hu11340267587176185191.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7kwojjVUAA3YA0_hu1270875721027376811.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7kpNabUEAAVPib_hu349270298502432432.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7kpNabUEAAVPib_hu12679458917352274742.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7kpNabUEAAVPib_hu6053149687244839744.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7kpNabUEAAVPib_hu12679458917352274742.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7ktXewVUAAMW1l_hu2842733485412397133.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7ktXewVUAAMW1l_hu13372082573434532185.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7ktXewVUAAMW1l_hu13443252403689070980.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7ktXewVUAAMW1l_hu13372082573434532185.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7ktbpLUIAAPAoj_hu7499823694652925524.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7ktbpLUIAAPAoj_hu15357971927328422256.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7ktbpLUIAAPAoj_hu5975043942323511030.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7ktbpLUIAAPAoj_hu15357971927328422256.jpeg alt></figure></p><p>Solderpaste went down well, I&rsquo;m using Loctite GC-10 here. The T4 variant.</p><p>You can see in this image that I forgot that the HDMI connector has pins that protrude through the PCB. So if I had reflowed the connector I would not be able to sit a stencil flush with the second side of the PCB. Doh.</p><p>The fix was pretty simple, leave the connector off, reflow, then assemble the second side with an additional reflow cycle then hand solder on the HDMI connector.</p><p>For extra units I simply soldered the FPGA side up first.</p><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7lCFeCUYAEayJT_hu247393320371053913.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7lCFeCUYAEayJT_hu3541499922051980790.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7lCFeCUYAEayJT_hu5086679000104667298.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7lCFeCUYAEayJT_hu3541499922051980790.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7lCFd1UIAIOKOn_hu17467189558686852017.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7lCFd1UIAIOKOn_hu5385476093350241306.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7lCFd1UIAIOKOn_hu8936323203851303932.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7lCFd1UIAIOKOn_hu5385476093350241306.jpeg alt></figure></p><p>You can see the device very much resembles the boson-frame-grabber design.</p><hr><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7lGd2MV4AAhq87_hu16487748720110174088.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7lGd2MV4AAhq87_hu5117208233758262137.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7lGd2MV4AAhq87_hu7516242790559277536.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7lGd2MV4AAhq87_hu5117208233758262137.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7lGckoUYAAi97S_hu12468099607007990186.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7lGckoUYAAi97S_hu3687468148883187258.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7lGckoUYAAi97S_hu2290617063577846724.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7lGckoUYAAi97S_hu3687468148883187258.jpeg alt></figure></p><p>You do need to be careful with the 80-pin Hirose mezzanine connector. You really want to keep the two mated PCBs parallel when removing them. I unfortunately damaged a connector removing it.</p><figure><img srcset="/posts/boson-frame-grabber-pt6/images/EAKTHIkVUAYIWzt_hu13220056268118703926.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/EAKTHIkVUAYIWzt_hu10683980072907229649.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/EAKTHIkVUAYIWzt_hu4039185881679752825.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/EAKTHIkVUAYIWzt_hu10683980072907229649.jpeg alt></figure><p>The full sized HDMI connector is a bit ridiculous given the size of the camera. So altough I typically don&rsquo;t like micro HDMI connectors, this was actually quite a nice fit for this camera</p><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D8S13nwVsAEKTH-_hu13516444083140545379.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D8S13nwVsAEKTH-_hu76113865185030939.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D8S13nwVsAEKTH-_hu14881304119622886517.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D8S13nwVsAEKTH-_hu76113865185030939.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/D7lGdWUUIAEWQjK_hu2885910033496868717.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/D7lGdWUUIAEWQjK_hu18311898731162828757.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/D7lGdWUUIAEWQjK_hu5935888086057264979.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/D7lGdWUUIAEWQjK_hu18311898731162828757.jpeg alt></figure></p><p>This prototype did work. However because I didn&rsquo;t include any RAM, the FPGA is only able to output a similar resolution, 640x512. In this case 640x480, with top/bottom rows of pixel removed.</p><p>This restriction is because we are essentially capturing a stream of pixels, and have to also output a stream of pixels to the display. In order for us to not run-out of pixels to send to the display We need to run the output clock rate a something very similar to the input.</p><p>Even with this hiccup, the prototype proved the design could work. So with the proof of concept done I started work on the design for a more production ready variant.</p><h3 id=inital-production-prototypes>Inital production prototypes<a hidden class=anchor aria-hidden=true href=#inital-production-prototypes>#</a></h3><p>Here is the initial production version, which turned out to have some layout bugs and issues.</p><p><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/EU_ov9CUcAA60UJ_hu2263382428581731310.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/EU_ov9CUcAA60UJ_hu2008709251584359550.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/EU_ov9CUcAA60UJ_hu13168173455071621897.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/EU_ov9CUcAA60UJ_hu2008709251584359550.jpeg alt></figure><figure class=img-left><img srcset="/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6_hu16361268078964927819.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6_hu2595696892967658064.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6_hu11922769667819905599.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/EU_ov9BUMAAhjK6_hu2595696892967658064.jpeg alt></figure></p><p>You can see I&rsquo;ve added the hyperRAM back to the board, and also added USB C for power/and comms.
The USB passes through a mux so you can use the Boson UVC device or talk to the FPGA at USB FS speeds. The USB is used to implement a bootloader that lets you update the device firmware/gateware.</p><p>Here is shot of the final production variant, that are available now on the group-gets store: <a href=https://store.groupgets.com/products/flir-boson-digital-video-adapter>https://store.groupgets.com/products/flir-boson-digital-video-adapter</a></p><figure><img srcset="/posts/boson-frame-grabber-pt6/images/ErW8eV8VEAMn9SF_hu10324058870258536065.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/ErW8eV8VEAMn9SF_hu2287643960166139035.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/ErW8eV8VEAMn9SF_hu2335887256228950072.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/ErW8eV8VEAMn9SF_hu2287643960166139035.jpeg alt></figure><h2 id=diva-gateware>DiVA gateware<a hidden class=anchor aria-hidden=true href=#diva-gateware>#</a></h2><p>The hardware for this camera is not open-source. But the gateware/firmware is!
You can find that here: <a href=https://github.com/gregdavill/DiVA-firmware>https://github.com/gregdavill/DiVA-firmware</a></p><p>As an example of what the device does here is a capture of it&rsquo;s output, with on-screen menus.</p><figure><img srcset="/posts/boson-frame-grabber-pt6/images/E8ztQJpVoAMnLXO_hu16026698592425761521.png 390w,
/posts/boson-frame-grabber-pt6/images/E8ztQJpVoAMnLXO_hu7050768220750970897.png 800w,
/posts/boson-frame-grabber-pt6/images/E8ztQJpVoAMnLXO_hu6648416083937523984.png 2160w" src=/posts/boson-frame-grabber-pt6/images/E8ztQJpVoAMnLXO_hu7050768220750970897.png alt></figure><p>The current stable gateware is based on LiteX and Serv, LiteX is a collection of CPUs and peripherals along with plumbing to connect them all up. It&rsquo;s written on top of migen, a method to describe and generate verilog from python. Serv is a serial RISCV implementation. It&rsquo;s interesting because it&rsquo;s quite small, therefore can run a quite a high frequency. However that higher frequency does need to overcome the fact that all instructions take at least 32 times longer to execute, because it&rsquo;s a serial CPU, it&rsquo;s internal data-path is only 1 bit wide, so to operate as a RISCV-RV32 it needs lots of extra cycles.</p><p>Compared to raw verilog, going around and finding cores, then connecting them together in a SoC design. I find using LiteX way more productive, but there is a bit of a learning curve.</p><p>The gateware that runs DiVA is essentially a SoC, HyperRAM controller, DMAs, and TMDS serializer. These components work together to capture a frame from the camera into memory, and then queue that frame for transmitting back out through the serializer.</p><p>v1.2 of the gateware also introduced a video scaler, which does appear to work, but might be distorting colours a bit, since it&rsquo;s just combining R,G,B values linearly with coefficients from the scaler. I&rsquo;ve been told that &ldquo;proper&rdquo; upscaling likely requires converting to a different colour space, combining colours, then converting back to RGB.</p><p>The scaler is a simple design I came up with after watching some lectures on multi-tap &ldquo;polyphase&rdquo; filters. The scaler only performs the up-scale operation. A stream of pixels comes through 4 &ldquo;taps&rdquo;. These taps cycle through coefficients that are loaded by the CPU. The coefficients have a flag to stall incoming pixels, but increment to the next step. This enables the upscaling operation. These coefficients are pre-calculated and match with a bilinear interpolation of the input to output ratio of scaling we want to achieve. I&rsquo;ll probably try to make a more detailed blog post about that at some point.</p><p>The scaler can perform various stretch operations, since different coefficients are used for X/Y.</p><ul><li>Fill (crops top/bottom)</li><li>Fit (borders on left/right)</li><li>Center 1:1</li><li>Full Screen (Changes aspect ratio)</li></ul><p>There is also some buffering logic in there to enable coefficient banks to swap at the end of frame, to avoid graphical distortions while switching scaling options.</p><h1 id=updated-diva-gateware>Updated DiVA gateware<a hidden class=anchor aria-hidden=true href=#updated-diva-gateware>#</a></h1><p>There are a few open issues with the existing DiVA gateware, notably that it currently only supports 800x600 output resolution. And many HDMI transmitters expect at least 1280x720.</p><p>The hardware should technically support this, but someone needs to sit down and write the gateware to do it. I have started, but it&rsquo;s far from complete yet.</p><p>I do also have plans to update the video pipeline to support more &ldquo;modern&rdquo; looking GUIs. But that work isn&rsquo;t completed yet. For the time being, here is a demo image, showing various GUI elements ontop of a noise source. Also note that it&rsquo;s output at 1280x720 resolution.</p><figure><img srcset="/posts/boson-frame-grabber-pt6/images/E8zngHWVEAQ1wuG_hu3191746141891917076.jpeg 390w,
/posts/boson-frame-grabber-pt6/images/E8zngHWVEAQ1wuG_hu131284079288809253.jpeg 800w,
/posts/boson-frame-grabber-pt6/images/E8zngHWVEAQ1wuG_hu17322993114996194976.jpeg 2160w" src=/posts/boson-frame-grabber-pt6/images/E8zngHWVEAQ1wuG_hu131284079288809253.jpeg alt></figure></div><footer class=post-footer><ul class=post-tags><li><a href=https://gregdavill.com/tags/boson/>Boson</a></li><li><a href=https://gregdavill.com/tags/boson-frame-grabber/>Boson-Frame-Grabber</a></li><li><a href=https://gregdavill.com/tags/thermal/>Thermal</a></li><li><a href=https://gregdavill.com/tags/diva/>DiVA</a></li></ul><nav class=paginav><a class=prev href=https://gregdavill.com/posts/dell-xps13-ram-upgrade/><span class=title>¬´ Prev</span><br><span>Dell XPS13 RAM Upgrade (7390)</span>
</a><a class=next href=https://gregdavill.com/posts/d20/><span class=title>Next ¬ª</span><br><span>2,400 LED icosahedron (20 sided)</span></a></nav></footer><div id=hyvor-talk-view></div><script type=text/javascript>dark_palette={accent:"#ffffff",accentText:"#000000",footerHeader:"#1b1818",footerHeaderText:"#cac7c7",box:"#232121",boxText:"#ffffff",boxLightText:"#aaaaaa",backgroundText:"#ffffff"},light_palette={accent:"#659DBD",accentText:"#FFFFFF",footerHeader:"#FAFAFA",footerHeaderText:"#484848",box:"#FFFFFF",boxText:"#111111",boxLightText:"#AAAAAA",backgroundText:"#111111"};var HYVOR_TALK_WEBSITE,HYVOR_TALK_CONFIG,palette=light_palette;document.body.className.includes("dark")&&(palette=dark_palette),HYVOR_TALK_WEBSITE=5683,HYVOR_TALK_CONFIG={url:!1,id:"a85772ade8048bf592546f41b5c62b79",palette},document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?hyvor_talk.setPalette(light_palette):hyvor_talk.setPalette(dark_palette)})</script><script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://gregdavill.com/>Greg Davill's Projects</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>light_bg="rgb(255, 255, 255)",dark_bg="rgb(29, 30, 32)";var palette_bg=light_bg;document.body.className.includes("dark")&&(palette_bg=dark_bg),document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?palette_bg=light_bg:palette_bg=dark_bg;const e=Array.from(document.querySelectorAll(".post-content img"));e.forEach(e=>{mediumZoom(e,{margin:0,background:palette_bg,scrollOffset:40,container:null,template:null})})});const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,background:palette_bg,scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>