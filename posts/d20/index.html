<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2,400 LED icosahedron (20 sided) | Greg Davill's Projects</title><meta name=keywords content><meta name=description content="A tennis ball sized, 20 sided, LED clad, regular polyhedron
Introduction The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project mini-led-cube I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels."><meta name=author content><link rel=canonical href=https://gregdavill.com/posts/d20/><link crossorigin=anonymous href=/assets/css/stylesheet.c67fb9d44b5a68d22242044c9bddb70c39d78233626c1c25a01ce8ce7c4bb761.css integrity="sha256-xn+51EtaaNIiQgRMm923DDnXgjNibBwloBzoznxLt2E=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gregdavill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gregdavill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gregdavill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://gregdavill.com/apple-touch-icon.png><link rel=mask-icon href=https://gregdavill.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="2,400 LED icosahedron (20 sided)"><meta property="og:description" content="A tennis ball sized, 20 sided, LED clad, regular polyhedron
Introduction The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project mini-led-cube I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels."><meta property="og:type" content="article"><meta property="og:url" content="https://gregdavill.com/posts/d20/"><meta property="og:image" content="https://gregdavill.com/posts/d20/images/001.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-09T21:00:00+10:30"><meta property="article:modified_time" content="2021-01-09T21:00:00+10:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gregdavill.com/posts/d20/images/001.jpeg"><meta name=twitter:title content="2,400 LED icosahedron (20 sided)"><meta name=twitter:description content="A tennis ball sized, 20 sided, LED clad, regular polyhedron
Introduction The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project mini-led-cube I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://gregdavill.com/posts/"},{"@type":"ListItem","position":3,"name":"2,400 LED icosahedron (20 sided)","item":"https://gregdavill.com/posts/d20/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2,400 LED icosahedron (20 sided)","name":"2,400 LED icosahedron (20 sided)","description":"A tennis ball sized, 20 sided, LED clad, regular polyhedron\nIntroduction The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project mini-led-cube I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels.","keywords":[],"articleBody":" A tennis ball sized, 20 sided, LED clad, regular polyhedron\nIntroduction The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project mini-led-cube I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels.\n(*high density: less than 2.5 mm pixel pitch)\nSo what next? I could make it smaller, improve the controller, improve the firmware. What about adding more sides?\nInspiration came from this origami figure that I’d built many years ago and that has been sitting on my shelf.\nI’d never seen a LED icosahedron before… Design decisions I started by thinking about at a birds-eye view of the project, what major aspects there would be. What I know I wanted from a design point of view, and what I still had to work out. Engineering projects are always about problem-solving, so it helps to have a clear view of the problems that lie ahead of you.\nPanels I would need to design a LED panel that was compact and contained all the electronics. This panel would be in the shape of an equilateral triangle, and have a method to connect it easily to other panels to form a chain. How would I arrange the LEDs on the surface of each panel to assist in routing. Knowing the panels were at different angles I would like them them to align no matter what orientation they were fitted in. 120 degree symmetry. Enclosure How will the panels be held together with minimal bezels 3d printing is an obvious answer since this enclosure has lots of weird angles Probably a 3d printing service that does resin or nylon Resin is discounted due to personal experiences with in being brittle and discolouring over time Want a black material, so the case isn’t noticeable Total overall size? Thinking tennis ball/rubiks cube sized to match the cube Controller Can make use of controller design for the cube, will need to be re-designed to fit in the smaller form-factor Power How will this be powered? 18650. RC hobby LiPo cells? I want to be able to carry this on a plane, will probably require something a little bit more friendly looking. Timeline I’m super late in writing this blog post. I started thinking about this project in September 2019, and want it ready to take to supercon 2019. Which I was leaving my lab on the 2nd of November. So I had a little under 2 months to pull it off. Design Stage At this point I had an idea in my head about what I wanted the device to look like. However there were no hard or fixed numbers yet. So I knew I needed to work out the dimensions of each panel first. I did this in my 3d CAD of choice, fusion 360. I looked up a tutorial about how to model an icosahedron, which was more complex than you might imagine. Once modeled, I scaled it to be roughly tennis ball sized, this left me with a triangular face with sides of 42mm. From this I inset slightly to give room for the panels to be sunken down into the enclosure.\nI had used 2x2mm LEDs for the cube, and knew they came in a smaller variant, 1.5x1.5mm. These would be perfect. They feature a black casing that helps highlight the round lens on the top. This is particularly important because as you move this around, some panels the LEDs might be rotated, but so long as round opening is in the same location you generally won’t notice.\nYou can get smaller LEDs, however these create some more challenges. I need to be able to route this board easily and didn’t want to start using HDI features. (Blind/buried vias). To achieve this a trace needs to be run through the middle fo the LED pads, this isn’t possible with these smaller 1x1mm or 0.7x0.7mm RGB LEDs. Secondly because they don’t feature the black enclosure I was worried that light bleed between pixels would be bad.\nBased on the experience I had with the cube I knew I could create a matrix arrangement for the LEDs, and make use of the 16bit constant-current LED drivers + 595/PMOS source drivers.\nThe TLC59025 sink drivers are set to a single current for the entire 16bits it’s a requirement to use 3, one each for R,G,B. This is because each colour will require a slightly different current to produce a nice white. I say “style” because you can find multiple pin compatible drivers. lcsc sell a few that have Chinese only datasheets, but because they’re designed as drop-in replacements that isn’t an issue. You can save quite a bit of money using these. Especially given I needed to use 60 of these in the project.\nThese drivers only turn ON/OFF they don’t handle any greyscale control themselves. Because of this you do want to connect both the LATCH and BLANK signals. This enables you to clock new data in while current data is being displayed. As well as control the exact interval data is displayed for. This and some FPGA logic is what enables high refresh rate greyscale control.\nThe architecture is shown above. There are a few interesting observations.\nI placed everything in a single serial string. This represents 64bits from input to output, and is primarily to reduce the pin count of the connectors, and hence the internal wiring. r0.1 boards did not have buffers, but I noticed after 3 panels there was some glitches. So I added those. I’ve include enough electronics to drive an entire 16x16 matrix, but only populate a triangular portion of it. This GREATLY helps with signal routing. I’m already at 4L to route power/signals on inner layers, but I tried routing it with just a single 8bit source driver, and failed. I opted for 6-pin 0.5mm pitch flat flex cables. These were actually a little bit tricky to find, ended up buying various lengths from an aliexpress seller. With the space available I am able to fit a triangular array of LEDs with 15 pixels across the base and 15 pixels high. this comes out to 120 LEDs per side.\nWith 20 sides this results in 2400 LEDs total. This will be fun to hand place! but I’ll leave that for future Greg to worry about.\nPanel r0.1 Shown above is the panel I sent off to have made at JLC PCB. (https://jlcpcb.com/) They were kind enough to provide free PCBs and stencils for this project.\nI placed this order on the 12th of September.\nThe boards arrived ~1 week later. And they looked good on the surface. I went to assemble one, and when trying to determine the LED orientation I discovered a fatal flaw. I had the footprint rotated 90 degrees. (-___-)\nI attempted to assemble a board bey placing LEDs at 90 degrees, but ultimately this was a failure, the pads look reasonably symmetrical, but they’re not exactly. So when placing the LEDs at 90 degrees there isn’t great surface tension during reflow to pull them into alignment. Yep, that alignment looks pretty ugly.\nAlso worth noting that because I did not have the FFC cables or connectors at this point, and I had not written the code to drive the display, I didn’t even attempt at powering this on. Maybe you can sense the foreshadowing, in this observation.\nPanels Take two Everything else about the panels seemed fine at that time, so I quickly adjusted the footprint. ripped up the top layer and re-routed. I had a bit of creative energy/motivation left at this point so I added 2 little dual input buffers to the design, This helps isolate each panel from the next. Particularly the clock line, and removes some glitches I was seeing on the cube design. With the routing complete I placed the order again with JLC, this time I just payed for the boards myself, because I was now on a tighter deadline and I didn’t feel like asking for more free stuff because of a dumb mistake on my end.\nI placed this order on the 10th of October\nEnclosure Let’s switch gears to the enclosure, with a design for the panels done I can export a 3d model from KiCad and start looking at how they’ll be integrated into an enclosure. I did have to model up a custom LED. Which was very useful to see how everything would be fitting.\nThe panels fit great, and the bezels looked thick enough to be manufacturable, now it was just a matter of going through and cutting away as much of the enclosure as possible. Nylon MJF prints are priced by they’re total size and how much total material ends up in the final print.\ncould not find image could not find image could not find image With regard to powering the device I managed to fit a Sony mirror-less camera battery in the enclosure, and even more surprising I found a compatible 3-pin terminal that actually fit the battery! (That’s one of the challenges of using this style of battery).\nI needed a way to insert/remove the battery, and I’d determined it was easiest to remove a section of the icosahedron with 5 panels in it, these 5 panels would have a single ribbon cable running between it and the base. The sections would have asymmetric locking features and magnets, so it could be securely fastened and removed.\ncould not find image I even tried to be clever and add locking features to the 3d print to retain the controller PCB. Fusions “look-at” [face] option and the section-analysis were vital in getting this designed.\nWith the two halves designed, and checked multiple times over a few days I was ready to order them. I don’t really know too many options around for quickly prototyping a Nylon MJF part, so I just opted for shapeways. I opted for their higher detail service, with express options. The order totalled $167.68 USD. I was hoping there wasn’t any issues with the design I’d overlooked, especially considering this was my first time designing a Nylon MJF part.\nI placed this order on the 12th of October.\nController I’d re-designed the controller, basically an exact replica of the one used on the cube, but with 4x 6 pin FFC’s out to the displays. The controller and enclosure were designed in tandem, there was a bit of back and forth to get everything to fit correctly. Thankfully this is pretty seamless with the dxf import in KiCad and the 3d STEP output.\nThe controller is based around a fast programmable SAMD51, this is an M4 core that can run up to 120MHz. Also, because the project wasn’t complex enough I decided I’d like to use rust to drive the system. And there are rust crates and support packages for the samd51.\nA button and USB connection ensure an easy way to update the firmware on the device, since access to the JTAG connector will be tricky once everything is assembled.\nThe ice40 FPGA offloads all the real-time display multiplexing, it outputs pixels to the 4 strings of panels in parallel, and achieves ~100Hz update rate from the frame buffer, while outputting gamma corrected 10 bit binary coded modulation for grayscale control over each pixel.\nOn the power supply front, it would have been nice to have a battery charger, but these Sony batteries are 7.4V nominal, which makes charging a tad more complex than just dropping in a single chip solution. I did still want tho device powered over USB when programming/debugging, so I added an ideal diode controller, which efficiently combines two input power sources. I also added a basic under voltage monitor to the battery to ensure that I didn’t over discharge the LiPo cells (Although I’ve now discovered that they might have this built in.)\nThis is the model I’d created for the controller. This is straight out of KiCad, and was essential to ensure a good mechanical compatibility between the PCBA’s and enclosure.\nI ordered these on the 10th October.\nAssembly Stage Circuit boards arrived on Friday 18th Oct.\nRapidly running out of time, I know I wanted to get a controller built, so I could start playing with the firmware. Also some LED panels built, so I could do a test-fit on the enclosure that would show up the following week. I got into a rhythm and ended up assembling the controller side on all the LED panels.\nThe soldering went great. I am using SAC305 Pb free paste, and stainless steel stencils that JLC provided with the PCBs.\nWith the controller side done I set up a jig to align the stencil on the top layer and apply solderpaste. I opted to do the LED side last mostly so that the LEDs only had to run through a single reflow cycle. I made a jig out of old PCBs to hold the panels by their rails in the oven, so that underside components were not touching anything. Surface tension should keep them all in place, but if a force was applied while the solder is molten there is a chance that they would move.\nWith solder applied to the PCB I placed the parts using a syringe with a blunt / bent dispensing needle. The syringe is connected to a small DC vacuum pump. This creates enough pressure to pick up parts from tape, and then when placed onto the solderpaste the extra force from the paste is enough to pull them off the syringe.\nI set up a wooden board on my table and used double-sided tape to stick down strips of the LED cut-tape, all in the same orientation. The PCB is positioned such that the LEDs just have to be moved, not rotated.\nI also built up a controller PCB. Also using solderpaste + reflow oven. And the enclosure arrived!\nEnclosure Test-fit The enclosure looked great! The texture from the MJF was a perfect fit with the look of the PCB/LEDs. The tolerance between the parts I had estimated perfectly. The magnets fit in both parts (One problem was I couldn’t actually get the magnets out.)\nThe controller board and battery fit great in the enclosure. So now it was time to dive into the firmware/gateware and get the LED displays working.\nFirmware and Mistakes I’d been putting this step off for a little while, because the gateware needed to be altered from the cube in order to drive this new panel type. The row and column data needed to be encoded into a 64bit pattern and then sent out to each display in the string.\nI coded this change up in a simulator, and confirmed that I was getting the correct signals out. So I hooked it up to an icebreaker (ice40 development board) and run my gateware. Nothing.\n…\nNothing happened.\nThis is not really unsurprising to be honest. There are a lot of things that need to be set correctly in order for code that looks correct in a verilog simulator to run correctly on hardware. So I powered up my scope and began probing around.\nSignals coming out of the FPGA: OK Signals appearing on the shift register inputs: OK Blank signal toggling: OK Latch signal: OK Data coming out of shift registers: OK Voltages: OK LEDs turned on: NAK Eventually I tested the value into the PMOS switches. Hmm, that’s weird. There was a signal on it’s gate, as expected, but source isn’t changing. Did I get the footprint wrong?\nI took off all the PMOS high side drivers on one of the boards, and bridged gate to drain. So effectively the 74 series 595’s were driving the LED high side directly.\nBig Ooof. -______________________-\nCurrent Date 20th Oct\nI had use the wrong footprint on both the r0.1 boards that had an incorrect LED footprint, and then also again on these! And didn’t pick up on it until now. So with less than 2 weeks I may have had just enough time to order new boards with this fixed. But then all 20 of the boards I’d built would be scrap.\nBodge time The temporary fix I’d put in place on the first board wasn’t going to work. The 595’s do not have enough current driving capability to match the current sink drivers. So when more than 3-4 LEDs are lit a single row the brightness really starts to dip, this produces very undesirable effects for the way the display is wired up.\nJust a few rework items how bad can it be?\nThe mosfets are in SOT-883 packages, which is the same size as a 0402 resistor. They have 3 pads underneath.\nAs shown in this datasheet page for an equivalent part.\nNote I did try and find a part with different pinout that would match my PCB. Unfortunately for me manufactures often like to stick to industry standard pinouts, so they can be drop-in replacements for competitors. It doesn’t really make any sense to release a mosfet with a different unique footprint.\nMy issue was that I had swapped G/S, the two smallest pads. My plan to rework these was to rotate the part such that the G/S pads were in correct orientation. Then with a small length of magnet wire connect the, now displaced, drain back to the PCB.\nSo that’s exactly what I did. For every PMOS on the LED panels.\nLet’s do some math real quick. 15 PMOS per panel * 20 panels = 300 bodge wires.\nSo that’s why I started using the saying “This project has 300 bodge wires inside”. I’m not sure on exactly how long it took me to complete all the rework, but I did make it through a 60Hr Audio book that week.\nI tried to have a bit of fun and film some rework under a thermal camera. This is a Boson 640, running at 30Hz with the widest lens. You can see a bit of distortion effects from the lens.\nWrapup I worked through each panel in turn, and did in fact manage to have it all completed (and working) before departing to the US on 2nd November. I did get quiet a few interesting questions from friendly folks at security. I think I generally I would describe it as an electronic art project.\nHere is a short video timelapse of the device being disassembled, assembly is the process just in reverse.\nHere is what one of the basic animations looks like.\nOverall I’m very happy with how it turned out, and I got lots of positive feedback on the project at supercon.\nDownloads If you’re feeling adventurous and want to build one of these for yourself I’d love to see it! Alternatively you can just check out the design files.\nHere is a repo with 3d printable files, and hardware designs for PCBs: https://github.com/gregdavill/d20-hardware\nThe proof of concept firmware that’s running on the device was written in rust, and is available here. (currently embedded in a modified atsamd crate that I added DMA support to): https://github.com/gregdavill/atsamd/tree/d20-controller\nGateware for the ice40 is based of the rgb_panel code from Sylvian “tnt” Munant, but with a slightly modified “phy” to support the unique shift register design of my panels: https://github.com/gregdavill/ice40-playground\nFuture work The controller is a big aspect which could be improved. Adding something with wireless connectivity would be great, to be able to sync up patterns and animations with another device.\nThe panels are working great, and r0.3 updates them, so they don’t require the bodges.\nI think a new controller board might include either an ESP32 or ESP32-S2 chip, along with the FPGA. This would provide a nice way to add extra features, while not having to worry about the tight timing on the display side of things.\nMapping of the pixels into a coordinate space would be very useful. I think this probably isn’t actually too difficult, but just requires wrapping my head around matrix multiplications to move the grid of pixels on each face from a 2d plane into position in 3d space around the icosahedron, then each pixels’ location can be recorded and used in a lookup table fashion to create interesting animations and effects. Charlie and his new favorite toy\nHeading image source: https://twitter.com/amiedoubleD/status/1205888820262121473 (photo by: https://twitter.com/JunesPhD)\n","wordCount":"3439","inLanguage":"en","image":"https://gregdavill.com/posts/d20/images/001.jpeg","datePublished":"2021-01-09T21:00:00+10:30","dateModified":"2021-01-09T21:00:00+10:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://gregdavill.com/posts/d20/"},"publisher":{"@type":"Organization","name":"Greg Davill's Projects","logo":{"@type":"ImageObject","url":"https://gregdavill.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gregdavill.com accesskey=h title="Greg Davill's Projects (Alt + H)">Greg Davill's Projects</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gregdavill.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://gregdavill.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://gregdavill.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gregdavill.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gregdavill.com>Home</a>&nbsp;»&nbsp;<a href=https://gregdavill.com/posts/>Posts</a></div><h1 class=post-title>2,400 LED icosahedron (20 sided)</h1><div class=post-meta><span title='2021-01-09 21:00:00 +1030 +1030'>January 9, 2021</span>&nbsp;·&nbsp;17 min&nbsp;|&nbsp;<a href=https://github.com/gregdavill/gregdavill.github.io/blob/main/blog-src/content/posts/d20/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><figure class=center><img srcset="/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_800x0_resize_q95_lanczos.jpeg alt></figure><p>A tennis ball sized, 20 sided, LED clad, regular polyhedron</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>The major challenge of making a smaller LED cube in my opinion is the LED panels. Commercially available panels are designed for video walls and typically made at 64x64 pixel as a minimum size. This seems to be a good trade off between cost/complexity/light efficiency. On my previous project <a href=/posts/mini-led-cube>mini-led-cube</a> I had overcome one of the major hurdles of creating a smaller cube, because I had designed and built my own custom high density* LED panels.</p><p>(*high density: less than 2.5 mm pixel pitch)</p><p>So what next? I could make it smaller, improve the controller, improve the firmware. What about adding more sides?</p><p>Inspiration came from this origami figure that I’d built many years ago and that has been sitting on my shelf.</p><p>I’d never seen a LED icosahedron before&mldr;<figure><img srcset="/posts/d20/images/IMG_9510_hu0a38df00839e3b2dcd81012b4ed6f061_137681_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/IMG_9510_hu0a38df00839e3b2dcd81012b4ed6f061_137681_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/IMG_9510_hu0a38df00839e3b2dcd81012b4ed6f061_137681_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/IMG_9510_hu0a38df00839e3b2dcd81012b4ed6f061_137681_800x0_resize_q95_lanczos.jpg alt></figure></p><h2 id=design-decisions>Design decisions<a hidden class=anchor aria-hidden=true href=#design-decisions>#</a></h2><p>I started by thinking about at a birds-eye view of the project, what major aspects there would be. What I know I wanted from a design point of view, and what I still had to work out. Engineering projects are always about problem-solving, so it helps to have a clear view of the problems that lie ahead of you.</p><h3 id=panels>Panels<a hidden class=anchor aria-hidden=true href=#panels>#</a></h3><ul><li>I would need to design a LED panel that was compact and contained all the electronics.</li><li>This panel would be in the shape of an equilateral triangle, and have a method to connect it easily to other panels to form a chain.</li><li>How would I arrange the LEDs on the surface of each panel to assist in routing. Knowing the panels were at different angles I would like them them to align no matter what orientation they were fitted in. 120 degree symmetry.</li></ul><h3 id=enclosure>Enclosure<a hidden class=anchor aria-hidden=true href=#enclosure>#</a></h3><ul><li>How will the panels be held together with minimal bezels</li><li>3d printing is an obvious answer since this enclosure has lots of weird angles</li><li>Probably a 3d printing service that does resin or nylon</li><li>Resin is discounted due to personal experiences with in being brittle and discolouring over time</li><li>Want a black material, so the case isn’t noticeable</li><li>Total overall size? Thinking tennis ball/rubiks cube sized to match the cube</li></ul><h3 id=controller>Controller<a hidden class=anchor aria-hidden=true href=#controller>#</a></h3><ul><li>Can make use of controller design for the cube, will need to be re-designed to fit in the smaller form-factor</li></ul><h3 id=power>Power<a hidden class=anchor aria-hidden=true href=#power>#</a></h3><ul><li>How will this be powered? 18650. RC hobby LiPo cells?</li><li>I want to be able to carry this on a plane, will probably require something a little bit more friendly looking.</li></ul><h3 id=timeline>Timeline<a hidden class=anchor aria-hidden=true href=#timeline>#</a></h3><ul><li>I’m super late in writing this blog post. I started thinking about this project in September 2019, and want it ready to take to supercon 2019. Which I was leaving my lab on the 2nd of November. So I had a little under 2 months to pull it off.</li></ul><h3 id=design-stage>Design Stage<a hidden class=anchor aria-hidden=true href=#design-stage>#</a></h3><p>At this point I had an idea in my head about what I wanted the device to look like. However there were no hard or fixed numbers yet. So I knew I needed to work out the dimensions of each panel first. I did this in my 3d CAD of choice, fusion 360. I looked up a tutorial about how to model an icosahedron, which was more complex than you might imagine. Once modeled, I scaled it to be roughly tennis ball sized, this left me with a triangular face with sides of 42mm. From this I inset slightly to give room for the panels to be sunken down into the enclosure.</p><figure><img srcset="/posts/d20/images/003_hufe943395e422fe6a22fd70f855db9508_58987_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/003_hufe943395e422fe6a22fd70f855db9508_58987_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/003_hufe943395e422fe6a22fd70f855db9508_58987_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/003_hufe943395e422fe6a22fd70f855db9508_58987_800x0_resize_q95_lanczos.jpeg alt></figure><p>I had used 2x2mm LEDs for the cube, and knew they came in a smaller variant, 1.5x1.5mm. These would be perfect. They feature a black casing that helps highlight the round lens on the top. This is particularly important because as you move this around, some panels the LEDs might be rotated, but so long as round opening is in the same location you generally won’t notice.</p><p>You can get smaller LEDs, however these create some more challenges. I need to be able to route this board easily and didn’t want to start using HDI features. (Blind/buried vias). To achieve this a trace needs to be run through the middle fo the LED pads, this isn’t possible with these smaller 1x1mm or 0.7x0.7mm RGB LEDs. Secondly because they don’t feature the black enclosure I was worried that light bleed between pixels would be bad.</p><p>Based on the experience I had with the cube I knew I could create a matrix arrangement for the LEDs, and make use of the 16bit constant-current LED drivers + 595/PMOS source drivers.</p><figure><img srcset="/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_800x0_resize_lanczos_3.png alt></figure><p>The TLC59025 sink drivers are set to a single current for the entire 16bits it’s a requirement to use 3, one each for R,G,B. This is because each colour will require a slightly different current to produce a nice white. I say “style” because you can find multiple pin compatible drivers. lcsc sell a few that have Chinese only datasheets, but because they’re designed as drop-in replacements that isn’t an issue. You can save quite a bit of money using these. Especially given I needed to use 60 of these in the project.</p><p>These drivers only turn ON/OFF they don’t handle any greyscale control themselves. Because of this you do want to connect both the LATCH and BLANK signals. This enables you to clock new data in while current data is being displayed. As well as control the exact interval data is displayed for. This and some FPGA logic is what enables high refresh rate greyscale control.</p><figure><img srcset="/posts/d20/images/005_huce3b17ad0656d920ba50361173170716_10821_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/005_huce3b17ad0656d920ba50361173170716_10821_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/005_huce3b17ad0656d920ba50361173170716_10821_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/005_huce3b17ad0656d920ba50361173170716_10821_800x0_resize_lanczos_3.png alt></figure><p>The architecture is shown above. There are a few interesting observations.</p><ul><li>I placed everything in a single serial string. This represents 64bits from input to output, and is primarily to reduce the pin count of the connectors, and hence the internal wiring.</li><li>r0.1 boards did not have buffers, but I noticed after 3 panels there was some glitches. So I added those.</li><li>I’ve include enough electronics to drive an entire 16x16 matrix, but only populate a triangular portion of it. This GREATLY helps with signal routing. I’m already at 4L to route power/signals on inner layers, but I tried routing it with just a single 8bit source driver, and failed.</li><li>I opted for 6-pin 0.5mm pitch flat flex cables. These were actually a little bit tricky to find, ended up buying various lengths from an aliexpress seller.</li></ul><p>With the space available I am able to fit a triangular array of LEDs with 15 pixels across the base and 15 pixels high. this comes out to 120 LEDs per side.</p><p>With 20 sides this results in 2400 LEDs total. This will be fun to hand place! but I’ll leave that for future Greg to worry about.</p><p><figure><img srcset="/posts/d20/images/006_hucec68f32f1b84166e728d6f5520f1832_178970_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/006_hucec68f32f1b84166e728d6f5520f1832_178970_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/006_hucec68f32f1b84166e728d6f5520f1832_178970_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/006_hucec68f32f1b84166e728d6f5520f1832_178970_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/007_hucd1c3787a7851d183a247a7e3695352d_176631_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/007_hucd1c3787a7851d183a247a7e3695352d_176631_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/007_hucd1c3787a7851d183a247a7e3695352d_176631_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/007_hucd1c3787a7851d183a247a7e3695352d_176631_800x0_resize_lanczos_3.png alt></figure></p><h2 id=panel-r01>Panel r0.1<a hidden class=anchor aria-hidden=true href=#panel-r01>#</a></h2><p>Shown above is the panel I sent off to have made at JLC PCB. (<a href=https://jlcpcb.com/>https://jlcpcb.com/</a>) They were kind enough to provide free PCBs and stencils for this project.</p><p><em>I placed this order on the 12th of September.</em></p><p><figure><img srcset="/posts/d20/images/008_hu79fb5fd23a6b99826911b00446ba71ca_95525_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/008_hu79fb5fd23a6b99826911b00446ba71ca_95525_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/008_hu79fb5fd23a6b99826911b00446ba71ca_95525_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/008_hu79fb5fd23a6b99826911b00446ba71ca_95525_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/009_hu415ffed483bf08480767d583266ce5c1_128031_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/009_hu415ffed483bf08480767d583266ce5c1_128031_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/009_hu415ffed483bf08480767d583266ce5c1_128031_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/009_hu415ffed483bf08480767d583266ce5c1_128031_800x0_resize_q95_lanczos.JPG alt></figure></p><p>The boards arrived ~1 week later. And they looked good on the surface. I went to assemble one, and when trying to determine the LED orientation I discovered a fatal flaw. I had the footprint rotated 90 degrees. (-___-)</p><p><figure><img srcset="/posts/d20/images/010_hudc5d42329070d5713e80168ea6785407_36196_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/010_hudc5d42329070d5713e80168ea6785407_36196_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/010_hudc5d42329070d5713e80168ea6785407_36196_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/010_hudc5d42329070d5713e80168ea6785407_36196_800x0_resize_q95_lanczos.jpeg alt></figure><figure><img srcset="/posts/d20/images/011_hud2d901533843b2bf55abc80244691d84_40750_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/011_hud2d901533843b2bf55abc80244691d84_40750_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/011_hud2d901533843b2bf55abc80244691d84_40750_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/011_hud2d901533843b2bf55abc80244691d84_40750_800x0_resize_q95_lanczos.jpeg alt></figure></p><p>I attempted to assemble a board bey placing LEDs at 90 degrees, but ultimately this was a failure, the pads look reasonably symmetrical, but they’re not exactly. So when placing the LEDs at 90 degrees there isn’t great surface tension during reflow to pull them into alignment. Yep, that alignment looks pretty ugly.</p><p>Also worth noting that because I did not have the FFC cables or connectors at this point, and I had not written the code to drive the display, I didn’t even attempt at powering this on. Maybe you can sense the foreshadowing, in this observation.</p><main class=grid><figure><img srcset="/posts/d20/images/012_hu5e3fdb9079356310ccae31eab3689091_166381_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/012_hu5e3fdb9079356310ccae31eab3689091_166381_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/012_hu5e3fdb9079356310ccae31eab3689091_166381_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/012_hu5e3fdb9079356310ccae31eab3689091_166381_800x0_resize_q95_lanczos.jpeg alt></figure><figure><img srcset="/posts/d20/images/013_hu88d08ae4f4ec3f84372683be1b3ed83f_176531_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/013_hu88d08ae4f4ec3f84372683be1b3ed83f_176531_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/013_hu88d08ae4f4ec3f84372683be1b3ed83f_176531_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/013_hu88d08ae4f4ec3f84372683be1b3ed83f_176531_800x0_resize_q95_lanczos.jpeg alt></figure></main><h2 id=panels-take-two>Panels Take two<a hidden class=anchor aria-hidden=true href=#panels-take-two>#</a></h2><p>Everything else about the panels seemed fine at that time, so I quickly adjusted the footprint. ripped up the top layer and re-routed. I had a bit of creative energy/motivation left at this point so I added 2 little dual input buffers to the design, This helps isolate each panel from the next. Particularly the clock line, and removes some glitches I was seeing on the cube design. With the routing complete I placed the order again with JLC, this time I just payed for the boards myself, because I was now on a tighter deadline and I didn’t feel like asking for more free stuff because of a dumb mistake on my end.</p><p><em>I placed this order on the 10th of October</em></p><h2 id=enclosure-1>Enclosure<a hidden class=anchor aria-hidden=true href=#enclosure-1>#</a></h2><p>Let&rsquo;s switch gears to the enclosure, with a design for the panels done I can export a 3d model from KiCad and start looking at how they’ll be integrated into an enclosure. I did have to model up a custom LED. Which was very useful to see how everything would be fitting.</p><main class=grid><figure><img srcset="/posts/d20/images/014_huca8416113d857c2879169f7d003577a0_369563_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/014_huca8416113d857c2879169f7d003577a0_369563_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/014_huca8416113d857c2879169f7d003577a0_369563_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/014_huca8416113d857c2879169f7d003577a0_369563_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/015_hue3654c5aecc2fa7dcfd59f48f1af0eab_262417_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/015_hue3654c5aecc2fa7dcfd59f48f1af0eab_262417_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/015_hue3654c5aecc2fa7dcfd59f48f1af0eab_262417_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/015_hue3654c5aecc2fa7dcfd59f48f1af0eab_262417_800x0_resize_lanczos_3.png alt></figure></main><p>The panels fit great, and the bezels looked thick enough to be manufacturable, now it was just a matter of going through and cutting away as much of the enclosure as possible. Nylon MJF prints are priced by they’re total size and how much total material ends up in the final print.</p><p>could not find image<main class=grid>could not find image
could not find image</main></p><p>With regard to powering the device I managed to fit a Sony mirror-less camera battery in the enclosure, and even more surprising I found a compatible 3-pin terminal that actually fit the battery! (That’s one of the challenges of using this style of battery).</p><p>I needed a way to insert/remove the battery, and I’d determined it was easiest to remove a section of the icosahedron with 5 panels in it, these 5 panels would have a single ribbon cable running between it and the base. The sections would have asymmetric locking features and magnets, so it could be securely fastened and removed.</p>could not find image<p>I even tried to be clever and add locking features to the 3d print to retain the controller PCB. Fusions “look-at” [face] option and the section-analysis were vital in getting this designed.</p><main class=grid><figure><img srcset="/posts/d20/images/020_hub482e606c1aa460676f2b8cac752824c_180963_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/020_hub482e606c1aa460676f2b8cac752824c_180963_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/020_hub482e606c1aa460676f2b8cac752824c_180963_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/020_hub482e606c1aa460676f2b8cac752824c_180963_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/021_hu1a9ca4c6bc6749603a37138b99ec49ab_274829_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/021_hu1a9ca4c6bc6749603a37138b99ec49ab_274829_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/021_hu1a9ca4c6bc6749603a37138b99ec49ab_274829_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/021_hu1a9ca4c6bc6749603a37138b99ec49ab_274829_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/022_hu13637f0d0fb0b0c886c982245b17bbdf_156127_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/022_hu13637f0d0fb0b0c886c982245b17bbdf_156127_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/022_hu13637f0d0fb0b0c886c982245b17bbdf_156127_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/022_hu13637f0d0fb0b0c886c982245b17bbdf_156127_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/023_hu49a734667188dcfdacdd7d19948fba27_253901_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/023_hu49a734667188dcfdacdd7d19948fba27_253901_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/023_hu49a734667188dcfdacdd7d19948fba27_253901_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/023_hu49a734667188dcfdacdd7d19948fba27_253901_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/024_huf93dd2ff7ab7c75fe6f1c930eaef7635_375941_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/024_huf93dd2ff7ab7c75fe6f1c930eaef7635_375941_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/024_huf93dd2ff7ab7c75fe6f1c930eaef7635_375941_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/024_huf93dd2ff7ab7c75fe6f1c930eaef7635_375941_800x0_resize_lanczos_3.png alt></figure><figure><img srcset="/posts/d20/images/025_huffa375128f7724ba63c04ad1447e26ba_238307_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/025_huffa375128f7724ba63c04ad1447e26ba_238307_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/025_huffa375128f7724ba63c04ad1447e26ba_238307_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/025_huffa375128f7724ba63c04ad1447e26ba_238307_800x0_resize_lanczos_3.png alt></figure></main><p>With the two halves designed, and checked multiple times over a few days I was ready to order them. I don’t really know too many options around for quickly prototyping a Nylon MJF part, so I just opted for shapeways. I opted for their higher detail service, with express options. The order totalled $167.68 USD. I was hoping there wasn’t any issues with the design I’d overlooked, especially considering this was my first time designing a Nylon MJF part.</p><p><em>I placed this order on the 12th of October.</em></p><h2 id=controller-1>Controller<a hidden class=anchor aria-hidden=true href=#controller-1>#</a></h2><p>I’d re-designed the controller, basically an exact replica of the one used on the cube, but with 4x 6 pin FFC’s out to the displays. The controller and enclosure were designed in tandem, there was a bit of back and forth to get everything to fit correctly. Thankfully this is pretty seamless with the dxf import in KiCad and the 3d STEP output.</p><figure><img srcset="/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/026_hubb300548752881f1b61471ed431fdbfb_8275_800x0_resize_lanczos_3.png alt></figure><p>The controller is based around a fast programmable SAMD51, this is an M4 core that can run up to 120MHz. Also, because the project wasn’t complex enough I decided I’d like to use rust to drive the system. And there are rust crates and support packages for the samd51.</p><p>A button and USB connection ensure an easy way to update the firmware on the device, since access to the JTAG connector will be tricky once everything is assembled.</p><p>The ice40 FPGA offloads all the real-time display multiplexing, it outputs pixels to the 4 strings of panels in parallel, and achieves ~100Hz update rate from the frame buffer, while outputting gamma corrected 10 bit binary coded modulation for grayscale control over each pixel.</p><p>On the power supply front, it would have been nice to have a battery charger, but these Sony batteries are 7.4V nominal, which makes charging a tad more complex than just dropping in a single chip solution. I did still want tho device powered over USB when programming/debugging, so I added an ideal diode controller, which efficiently combines two input power sources. I also added a basic under voltage monitor to the battery to ensure that I didn’t over discharge the LiPo cells (Although I’ve now discovered that they might have this built in.)</p><p><figure><img srcset="/posts/d20/images/027_hu2836797cb968000faa4a857ccbd11cf1_35995_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/027_hu2836797cb968000faa4a857ccbd11cf1_35995_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/027_hu2836797cb968000faa4a857ccbd11cf1_35995_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/027_hu2836797cb968000faa4a857ccbd11cf1_35995_800x0_resize_q95_lanczos.jpg alt></figure><main class=grid><figure><img srcset="/posts/d20/images/028_huebb97161dc63990115a94ccbc3388776_73272_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/028_huebb97161dc63990115a94ccbc3388776_73272_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/028_huebb97161dc63990115a94ccbc3388776_73272_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/028_huebb97161dc63990115a94ccbc3388776_73272_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/029_hu2958e356ad88c12da8d3eaa03c6cf719_47876_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/029_hu2958e356ad88c12da8d3eaa03c6cf719_47876_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/029_hu2958e356ad88c12da8d3eaa03c6cf719_47876_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/029_hu2958e356ad88c12da8d3eaa03c6cf719_47876_800x0_resize_q95_lanczos.jpg alt></figure></main></p><p>This is the model I’d created for the controller. This is straight out of KiCad, and was essential to ensure a good mechanical compatibility between the PCBA’s and enclosure.</p><p><em>I ordered these on the 10th October.</em></p><h2 id=assembly-stage>Assembly Stage<a hidden class=anchor aria-hidden=true href=#assembly-stage>#</a></h2><main class=grid><figure><img srcset="/posts/d20/images/030_hua0287f07d464689ff681608d617a6af6_123414_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/030_hua0287f07d464689ff681608d617a6af6_123414_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/030_hua0287f07d464689ff681608d617a6af6_123414_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/030_hua0287f07d464689ff681608d617a6af6_123414_800x0_resize_q95_lanczos.jpeg alt></figure><figure><img srcset="/posts/d20/images/031_hu415ffed483bf08480767d583266ce5c1_152834_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/031_hu415ffed483bf08480767d583266ce5c1_152834_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/031_hu415ffed483bf08480767d583266ce5c1_152834_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/031_hu415ffed483bf08480767d583266ce5c1_152834_800x0_resize_q95_lanczos.JPG alt></figure></main><p><em>Circuit boards arrived on Friday 18th Oct.</em></p><p>Rapidly running out of time, I know I wanted to get a controller built, so I could start playing with the firmware. Also some LED panels built, so I could do a test-fit on the enclosure that would show up the following week. I got into a rhythm and ended up assembling the controller side on <em>all</em> the LED panels.</p><p><figure><img srcset="/posts/d20/images/032_hu415ffed483bf08480767d583266ce5c1_126174_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/032_hu415ffed483bf08480767d583266ce5c1_126174_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/032_hu415ffed483bf08480767d583266ce5c1_126174_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/032_hu415ffed483bf08480767d583266ce5c1_126174_800x0_resize_q95_lanczos.JPG alt></figure><figure><img srcset="/posts/d20/images/033_hu415ffed483bf08480767d583266ce5c1_128092_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/033_hu415ffed483bf08480767d583266ce5c1_128092_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/033_hu415ffed483bf08480767d583266ce5c1_128092_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/033_hu415ffed483bf08480767d583266ce5c1_128092_800x0_resize_q95_lanczos.JPG alt></figure></p><p>The soldering went great. I am using SAC305 Pb free paste, and stainless steel stencils that JLC provided with the PCBs.</p><p>With the controller side done I set up a jig to align the stencil on the top layer and apply solderpaste. I opted to do the LED side last mostly so that the LEDs only had to run through a single reflow cycle. I made a jig out of old PCBs to hold the panels by their rails in the oven, so that underside components were not touching anything. Surface tension should keep them all in place, but if a force was applied while the solder is molten there is a chance that they would move.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/zw0IEoTWBg0 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><blockquote></blockquote><p>With solder applied to the PCB I placed the parts using a syringe with a blunt / bent dispensing needle. The syringe is connected to a small DC vacuum pump. This creates enough pressure to pick up parts from tape, and then when placed onto the solderpaste the extra force from the paste is enough to pull them off the syringe.</p><p>I set up a wooden board on my table and used double-sided tape to stick down strips of the LED cut-tape, all in the same orientation. The PCB is positioned such that the LEDs just have to be moved, not rotated.</p><figure><img srcset="/posts/d20/images/034_hud4388660a0c0e3e893cdf404d80bfb7a_151562_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/034_hud4388660a0c0e3e893cdf404d80bfb7a_151562_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/034_hud4388660a0c0e3e893cdf404d80bfb7a_151562_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/034_hud4388660a0c0e3e893cdf404d80bfb7a_151562_800x0_resize_q95_lanczos.JPG alt></figure><p>I also built up a controller PCB. Also using solderpaste + reflow oven. And the enclosure arrived!</p><h2 id=enclosure-test-fit>Enclosure Test-fit<a hidden class=anchor aria-hidden=true href=#enclosure-test-fit>#</a></h2><main class=grid><figure><img srcset="/posts/d20/images/035_hu5d70f1161ecc75da8066bd3c02e4fc11_118203_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/035_hu5d70f1161ecc75da8066bd3c02e4fc11_118203_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/035_hu5d70f1161ecc75da8066bd3c02e4fc11_118203_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/035_hu5d70f1161ecc75da8066bd3c02e4fc11_118203_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/036_hu849b034c7800830e3dc6ab1add14a36c_121267_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/036_hu849b034c7800830e3dc6ab1add14a36c_121267_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/036_hu849b034c7800830e3dc6ab1add14a36c_121267_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/036_hu849b034c7800830e3dc6ab1add14a36c_121267_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/037_hu5bb17bdbbcd2440046f96a7d3f9350d5_115436_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/037_hu5bb17bdbbcd2440046f96a7d3f9350d5_115436_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/037_hu5bb17bdbbcd2440046f96a7d3f9350d5_115436_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/037_hu5bb17bdbbcd2440046f96a7d3f9350d5_115436_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/038_huad47b9bda97fcacb2763682513a10499_175040_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/038_huad47b9bda97fcacb2763682513a10499_175040_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/038_huad47b9bda97fcacb2763682513a10499_175040_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/038_huad47b9bda97fcacb2763682513a10499_175040_800x0_resize_q95_lanczos.jpeg alt></figure></main><figure><img srcset="/posts/d20/images/039_hudff15d6379c784b340c43262f1993ac8_142063_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/039_hudff15d6379c784b340c43262f1993ac8_142063_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/039_hudff15d6379c784b340c43262f1993ac8_142063_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/039_hudff15d6379c784b340c43262f1993ac8_142063_800x0_resize_q95_lanczos.jpg alt></figure><p>The enclosure looked great! The texture from the MJF was a perfect fit with the look of the PCB/LEDs. The tolerance between the parts I had estimated perfectly. The magnets fit in both parts (One problem was I couldn’t actually get the magnets out.)</p><p>The controller board and battery fit great in the enclosure. So now it was time to dive into the firmware/gateware and get the LED displays working.</p><h2 id=firmware-and-mistakes>Firmware and Mistakes<a hidden class=anchor aria-hidden=true href=#firmware-and-mistakes>#</a></h2><p>I’d been putting this step off for a little while, because the gateware needed to be altered from the cube in order to drive this new panel type. The row and column data needed to be encoded into a 64bit pattern and then sent out to each display in the string.</p><p>I coded this change up in a simulator, and confirmed that I was getting the correct signals out. So I hooked it up to an icebreaker (ice40 development board) and run my gateware. Nothing.</p><p>&mldr;</p><p>Nothing happened.</p><p>This is not really unsurprising to be honest. There are a lot of things that need to be set correctly in order for code that looks correct in a verilog simulator to run correctly on hardware. So I powered up my scope and began probing around.</p><ul><li>Signals coming out of the FPGA: OK</li><li>Signals appearing on the shift register inputs: OK</li><li>Blank signal toggling: OK</li><li>Latch signal: OK</li><li>Data coming out of shift registers: OK</li><li>Voltages: OK</li><li>LEDs turned on: NAK</li></ul><figure><img srcset="/posts/d20/images/040_hu38733e727b4cd12a4da693e84044f2d2_135774_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/040_hu38733e727b4cd12a4da693e84044f2d2_135774_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/040_hu38733e727b4cd12a4da693e84044f2d2_135774_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/040_hu38733e727b4cd12a4da693e84044f2d2_135774_800x0_resize_q95_lanczos.jpg alt></figure><p>Eventually I tested the value into the PMOS switches. Hmm, that’s weird. There was a signal on it’s gate, as expected, but source isn’t changing. Did I get the footprint wrong?</p><p>I took off all the PMOS high side drivers on one of the boards, and bridged gate to drain. So effectively the 74 series 595’s were driving the LED high side directly.</p><figure><img srcset="/posts/d20/images/041_hu415ffed483bf08480767d583266ce5c1_134461_390x0_resize_q95_lanczos.JPG 390w,
/posts/d20/images/041_hu415ffed483bf08480767d583266ce5c1_134461_800x0_resize_q95_lanczos.JPG 800w,
/posts/d20/images/041_hu415ffed483bf08480767d583266ce5c1_134461_2160x0_resize_q95_lanczos.JPG 2160w" src=/posts/d20/images/041_hu415ffed483bf08480767d583266ce5c1_134461_800x0_resize_q95_lanczos.JPG alt></figure><p>Big Ooof. -______________________-</p><p><em>Current Date 20th Oct</em></p><figure><img srcset="/posts/d20/images/042_hu85d1ace7df642d84d64b69cfed787e0d_29776_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/042_hu85d1ace7df642d84d64b69cfed787e0d_29776_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/042_hu85d1ace7df642d84d64b69cfed787e0d_29776_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/042_hu85d1ace7df642d84d64b69cfed787e0d_29776_800x0_resize_lanczos_3.png alt></figure><p>I had use the wrong footprint on both the r0.1 boards that had an incorrect LED footprint, and then also again on these! And didn’t pick up on it until now. So with less than 2 weeks I may have had just enough time to order new boards with this fixed. But then all 20 of the boards I’d built would be scrap.</p><figure><img srcset="/posts/d20/images/043_huf0f18eb04645271f65916129e86682d3_155220_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/043_huf0f18eb04645271f65916129e86682d3_155220_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/043_huf0f18eb04645271f65916129e86682d3_155220_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/043_huf0f18eb04645271f65916129e86682d3_155220_800x0_resize_q95_lanczos.jpg alt></figure><h2 id=bodge-time>Bodge time<a hidden class=anchor aria-hidden=true href=#bodge-time>#</a></h2><p>The temporary fix I’d put in place on the first board wasn’t going to work. The 595’s do not have enough current driving capability to match the current sink drivers. So when more than 3-4 LEDs are lit a single row the brightness really starts to dip, this produces very undesirable effects for the way the display is wired up.</p><p>Just a few rework items how bad can it be?</p><p><figure><img srcset="/posts/d20/images/044_huebcc490951be62420ce0add886f1a5d5_93898_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/044_huebcc490951be62420ce0add886f1a5d5_93898_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/044_huebcc490951be62420ce0add886f1a5d5_93898_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/044_huebcc490951be62420ce0add886f1a5d5_93898_800x0_resize_q95_lanczos.jpg alt></figure><figure class=img-right><img srcset="/posts/d20/images/045_hueecc944bc98ee1605078a60827b0fb91_49617_390x0_resize_lanczos_3.png 390w,
/posts/d20/images/045_hueecc944bc98ee1605078a60827b0fb91_49617_800x0_resize_lanczos_3.png 800w,
/posts/d20/images/045_hueecc944bc98ee1605078a60827b0fb91_49617_2160x0_resize_lanczos_3.png 2160w" src=/posts/d20/images/045_hueecc944bc98ee1605078a60827b0fb91_49617_800x0_resize_lanczos_3.png alt></figure></p><p>The mosfets are in SOT-883 packages, which is the same size as a 0402 resistor. They have 3 pads underneath.</p><p>As shown in this datasheet page for an equivalent part.</p><p>Note I did try and find a part with different pinout that would match my PCB. Unfortunately for me manufactures often like to stick to industry standard pinouts, so they can be drop-in replacements for competitors. It doesn’t really make any sense to release a mosfet with a different unique footprint.</p><figure><img srcset="/posts/d20/images/047_hua9ede7685ce4a3e9eb17f1652d9fd92d_75253_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/047_hua9ede7685ce4a3e9eb17f1652d9fd92d_75253_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/047_hua9ede7685ce4a3e9eb17f1652d9fd92d_75253_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/047_hua9ede7685ce4a3e9eb17f1652d9fd92d_75253_800x0_resize_q95_lanczos.jpg alt></figure><p>My issue was that I had swapped G/S, the two smallest pads. My plan to rework these was to rotate the part such that the G/S pads were in correct orientation. Then with a small length of magnet wire connect the, now displaced, drain back to the PCB.</p><main class=grid><figure><img srcset="/posts/d20/images/048_huacb419733526100eb3d7b818d83a21c5_119582_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/048_huacb419733526100eb3d7b818d83a21c5_119582_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/048_huacb419733526100eb3d7b818d83a21c5_119582_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/048_huacb419733526100eb3d7b818d83a21c5_119582_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/049_hu5f5c520a1d05c25f2a65209f08b666c1_131593_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/049_hu5f5c520a1d05c25f2a65209f08b666c1_131593_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/049_hu5f5c520a1d05c25f2a65209f08b666c1_131593_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/049_hu5f5c520a1d05c25f2a65209f08b666c1_131593_800x0_resize_q95_lanczos.jpg alt></figure></main><p><figure><img srcset="/posts/d20/images/050_hu0de842c0c0d595afdb6ae093ba535c7e_157678_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/050_hu0de842c0c0d595afdb6ae093ba535c7e_157678_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/050_hu0de842c0c0d595afdb6ae093ba535c7e_157678_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/050_hu0de842c0c0d595afdb6ae093ba535c7e_157678_800x0_resize_q95_lanczos.jpg alt></figure><figure><img srcset="/posts/d20/images/051_hube4e53053fbb83ef948ffc3e39eb8014_149999_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/051_hube4e53053fbb83ef948ffc3e39eb8014_149999_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/051_hube4e53053fbb83ef948ffc3e39eb8014_149999_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/051_hube4e53053fbb83ef948ffc3e39eb8014_149999_800x0_resize_q95_lanczos.jpg alt></figure></p><p>So that’s exactly what I did. For every PMOS on the LED panels.</p><p>Let&rsquo;s do some math real quick. 15 PMOS per panel * 20 panels = 300 bodge wires.</p><p>So that’s why I started using the saying “This project has 300 bodge wires inside”. I’m not sure on exactly how long it took me to complete all the rework, but I did make it through a 60Hr Audio book that week.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/1Wr2pNi2tT4 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><blockquote></blockquote><p>I tried to have a bit of fun and film some rework under a thermal camera. This is a Boson 640, running at 30Hz with the widest lens. You can see a bit of distortion effects from the lens.</p><figure><img srcset="/posts/d20/images/052_hu08f3bb80d39ae33b007be7384e586f68_162945_390x0_resize_q95_lanczos.jpg 390w,
/posts/d20/images/052_hu08f3bb80d39ae33b007be7384e586f68_162945_800x0_resize_q95_lanczos.jpg 800w,
/posts/d20/images/052_hu08f3bb80d39ae33b007be7384e586f68_162945_2160x0_resize_q95_lanczos.jpg 2160w" src=/posts/d20/images/052_hu08f3bb80d39ae33b007be7384e586f68_162945_800x0_resize_q95_lanczos.jpg alt></figure><h2 id=wrapup>Wrapup<a hidden class=anchor aria-hidden=true href=#wrapup>#</a></h2><p>I worked through each panel in turn, and did in fact manage to have it all completed (and working) before departing to the US on 2nd November. I did get quiet a few interesting questions from friendly folks at security. I think I generally I would describe it as an electronic art project.</p><p>Here is a short video timelapse of the device being disassembled, assembly is the process just in reverse.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/qT3ABvyUdHE style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><blockquote></blockquote><p>Here is what one of the basic animations looks like.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/1YSZQUhk3f8 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><blockquote></blockquote><p>Overall I’m very happy with how it turned out, and I got lots of positive feedback on the project at supercon.</p><figure><img srcset="/posts/d20/images/053_hu0050d0369222b880f381dedbf2ad1aa9_92434_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/053_hu0050d0369222b880f381dedbf2ad1aa9_92434_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/053_hu0050d0369222b880f381dedbf2ad1aa9_92434_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/053_hu0050d0369222b880f381dedbf2ad1aa9_92434_800x0_resize_q95_lanczos.jpeg alt></figure><h2 id=downloads>Downloads<a hidden class=anchor aria-hidden=true href=#downloads>#</a></h2><p>If you’re feeling adventurous and want to build one of these for yourself I’d love to see it! Alternatively you can just check out the design files.</p><p>Here is a repo with 3d printable files, and hardware designs for PCBs: <a href=https://github.com/gregdavill/d20-hardware>https://github.com/gregdavill/d20-hardware</a></p><p>The proof of concept firmware that’s running on the device was written in rust, and is available here. (currently embedded in a modified atsamd crate that I added DMA support to): <a href=https://github.com/gregdavill/atsamd/tree/d20-controller>https://github.com/gregdavill/atsamd/tree/d20-controller</a></p><p>Gateware for the ice40 is based of the rgb_panel code from Sylvian “tnt” Munant, but with a slightly modified “phy” to support the unique shift register design of my panels: <a href=https://github.com/gregdavill/ice40-playground>https://github.com/gregdavill/ice40-playground</a></p><h2 id=future-work>Future work<a hidden class=anchor aria-hidden=true href=#future-work>#</a></h2><p>The controller is a big aspect which could be improved. Adding something with wireless connectivity would be great, to be able to sync up patterns and animations with another device.</p><p>The panels are working great, and r0.3 updates them, so they don’t require the bodges.</p><p>I think a new controller board might include either an ESP32 or ESP32-S2 chip, along with the FPGA. This would provide a nice way to add extra features, while not having to worry about the tight timing on the display side of things.</p><p>Mapping of the pixels into a coordinate space would be very useful. I think this probably isn’t actually too difficult, but just requires wrapping my head around matrix multiplications to move the grid of pixels on each face from a 2d plane into position in 3d space around the icosahedron, then each pixels&rsquo; location can be recorded and used in a lookup table fashion to create interesting animations and effects.
Charlie and his new favorite toy</p><p><img loading=lazy src=images/d20.gif alt></p><hr><p><figure class=center><img srcset="/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_390x0_resize_q95_lanczos.jpeg 390w,
/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_800x0_resize_q95_lanczos.jpeg 800w,
/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_2160x0_resize_q95_lanczos.jpeg 2160w" src=/posts/d20/images/001_hu7be0643dc4af71edfd1ca2c5e10802db_65651_800x0_resize_q95_lanczos.jpeg alt></figure>Heading image source: <em><a href=https://twitter.com/amiedoubleD/status/1205888820262121473>https://twitter.com/amiedoubleD/status/1205888820262121473</a> (photo by: <a href=https://twitter.com/JunesPhD>https://twitter.com/JunesPhD</a>)</em></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://gregdavill.com/posts/boson-frame-grabber-pt6/><span class=title>« Prev</span><br><span>Boson Frame Grabber Part 6</span></a>
<a class=next href=https://gregdavill.com/posts/boson-frame-grabber-pt5/><span class=title>Next »</span><br><span>Boson Frame Grabber Part 5</span></a></nav></footer><div id=hyvor-talk-view></div><script type=text/javascript>dark_palette={accent:"#ffffff",accentText:"#000000",footerHeader:"#1b1818",footerHeaderText:"#cac7c7",box:"#232121",boxText:"#ffffff",boxLightText:"#aaaaaa",backgroundText:"#ffffff"},light_palette={accent:"#659DBD",accentText:"#FFFFFF",footerHeader:"#FAFAFA",footerHeaderText:"#484848",box:"#FFFFFF",boxText:"#111111",boxLightText:"#AAAAAA",backgroundText:"#111111"};var palette=light_palette,HYVOR_TALK_WEBSITE,HYVOR_TALK_CONFIG;document.body.className.includes("dark")&&(palette=dark_palette),HYVOR_TALK_WEBSITE=5683,HYVOR_TALK_CONFIG={url:!1,id:"ea66c49baf0b1a9eea01f0b2eb25e9b3",palette},document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?hyvor_talk.setPalette(light_palette):hyvor_talk.setPalette(dark_palette)})</script><script async type=text/javascript src=//talk.hyvor.com/web-api/embed.js></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://gregdavill.com>Greg Davill's Projects</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>light_bg="rgb(255, 255, 255)",dark_bg="rgb(29, 30, 32)";var palette_bg=light_bg;document.body.className.includes("dark")&&(palette_bg=dark_bg),document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?palette_bg=light_bg:palette_bg=dark_bg;const e=Array.from(document.querySelectorAll(".post-content img"));e.forEach(e=>{mediumZoom(e,{margin:0,background:palette_bg,scrollOffset:40,container:null,template:null})})});const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,background:palette_bg,scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>